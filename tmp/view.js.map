{"version":3,"sources":["../client/js/view.js"],"names":[],"mappings":"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","file":"view.js","sourcesContent":["// Require react and UI components\nvar React = require('react');\nvar Login = require('./login.js');\nvar ActivityCardList = require('./activity-card-list.js');\nvar OptIn = require('./opt-in.js');\nvar EditActivity = require('./edit-activity.js');\nvar Header = require('./header.js');\nvar FabButton = require('./fab.js');\n\n// Require core logic\nvar models = require('./models.js');\nvar swLibrary = require('./swsetup.js')\nvar m = require('./m.js');\n\nvar SCREEN = {create: 0, list: 1, edit: 2, loggedOut: 3, notificationsOptIn: 5};\n\nvar App = React.createClass({\n\n  getInitialState: function () {\n    return { screen: SCREEN.loggedOut }\n  },\n\n  render: function() {\n    // TODO: Refactor this mess!\n    if (this.state.screen == SCREEN.loggedOut) {\n      return <Login onLoginComplete={this.handleViewList} />;\n    } else {\n      var mainContents;\n      if (this.state.screen == SCREEN.list) {\n        mainContents = (\n          <ActivityCardList\n            onAttendClick={this.handleAttend}\n            onUnattendClick={this.handleUnattend}\n            onEditClick={this.handleStartEditing}\n          />\n        );\n      } else if (this.state.screen == SCREEN.notificationsOptIn) {\n        mainContents = (\n          <OptIn\n            reason={this.state.optInReason}\n            nextState={this.state.nextScreen}\n            onOptInComplete={this.handleOptInComplete}\n          />\n        );\n      } else if ([SCREEN.create, SCREEN.edit].indexOf(this.state.screen) > -1) {\n        mainContents = (\n          <EditActivity\n            activity={this.state.activityForEditing}\n            userName={models.user.getUserName()}\n            onSaveComplete={this.handleActivitySaveComplete}\n            onCreateComplete={this.handleActivityCreateComplete}\n            onDeleteComplete={this.handleViewList}\n          />\n        );\n      }\n      var headerIfNeeded = null;\n      if (this.shouldShowHeader()) {\n        headerIfNeeded = (\n          <Header\n            title={this.getScreenTitle()}\n            shouldShowBackButton={this.shouldShowBackButton()}\n            onBackButtonClick={this.handleViewList}\n          />\n        );\n      }\n      var createButtonIfNeeded = null;\n      if (this.shouldShowCreateButton()) {\n        createButtonIfNeeded = <FabButton onClick={this.handleStartCreating} />;\n      }\n      return (\n        <div>\n          <div id='container'>\n            {mainContents}\n            <div style={{height: '100px'}}></div>\n          </div>\n          { /* Note these must be below the container to capture the clicks */ }\n          { headerIfNeeded }\n          { createButtonIfNeeded }\n        </div>\n      )\n    }\n  },\n\n  shouldShowHeader: function () {\n    return !([SCREEN.uninitialized, SCREEN.loggedOut].indexOf(this.state.screen) > -1);\n  },\n\n  shouldShowBackButton: function () {\n    return ([SCREEN.create, SCREEN.edit].indexOf(this.state.screen) > -1);\n  },\n\n  shouldShowCreateButton: function () {\n    return (this.state.screen == SCREEN.list);\n  },\n\n  handleScreenChange: function (newScreen, options, userTriggered) {\n    if (options && options.nextScreen) {\n      this.setState({nextScreen: options.nextScreen, optInReason: options.reason});\n    }\n    console.log('Changing state to '+newScreen);\n    this.setState({screen: newScreen});\n  },\n\n  handleStartEditing: function (activity) {\n    this.setState({screen: SCREEN.edit, activityForEditing: activity});\n  },\n\n  handleStartCreating: function () {\n    // Create mode and edit are the same, so make sure we aren't still referring\n    // to another activity for editing\n    this.setState({screen: SCREEN.create, activityForEditing: undefined});\n  },\n\n  // Syntactic sugar since we call this all the time\n  handleViewList: function () {\n    this.handleScreenChange(SCREEN.list);\n  },\n\n  getScreenTitle: function() {\n    if (this.state.screen == SCREEN.list) {\n      return 'Upcoming Plans';\n    } else if (this.state.screen == SCREEN.edit) {\n      return 'Edit';\n    } else if (this.state.screen == SCREEN.create) {\n      return 'Create'\n    } else if (this.state.screen == SCREEN.notificationsOptIn) {\n      return 'Stay up to date'\n    } else {\n      return 'Uh oh: title shouldn\\'t be showing';\n    }\n  },\n\n  handleOptInComplete: function () {\n    this.setState({screen: this.state.nextScreen});\n  },\n\n  handleActivitySaveComplete: function () {\n    // Don't ask the user to grant permission unless the browser supports it\n    if (swLibrary.browserSupportsSWAndNotifications()) {\n      swLibrary.hasPushNotificationPermission(() => {\n        this.handleViewList();\n      }, () => {\n        this.handleScreenChange(SCREEN.notificationsOptIn, {nextScreen: SCREEN.list, userTriggered: true, reason: 'when a friend says they want to come along'}, false);\n      });\n    } else {\n      this.handleViewList();\n    }\n  },\n\n  handleActivityCreateComplete: function () {\n    // From a flow standpoint we do the same when creating as saving\n    this.handleActivitySaveComplete();\n  },\n\n  handleAttend: function (activity) {\n    // Note we change screen without waiting for network to complete\n    // Don't ask the user to grant permission unless the browser supports it\n    if (swLibrary.browserSupportsSWAndNotifications()) {\n      swLibrary.hasPushNotificationPermission(() => {\n        this.handleViewList();\n      }, () => {\n        this.handleScreenChange(SCREEN.notificationsOptIn, {nextScreen: SCREEN.list, userTriggered: true, reason: 'if the plan changes'}, false);\n      });\n    } else {\n      this.handleViewList();\n    }\n    // Note no callback since the list will automatically redraw when this changes\n    var optimistic = activity.dirty == undefined;\n    models.activities.trySetAttending(activity, !activity.is_attending, optimistic, () => {}, () => {\n      console.log('Uhoh, an optimistic error was a mistake!!');\n      alert('An unexpected error occurred. Please refresh.');\n    });\n  },\n\n  handleUnattend: function (activity) {\n    // Note no callback since the list will automatically redraw when this changes\n    var optimistic = activity.dirty == undefined;\n    models.activities.trySetAttending(activity, !activity.is_attending, optimistic, () => {}, () => {\n      console.log('Uhoh, an optimistic error was a mistake!!');\n      alert('An unexpected error occurred. Please refresh.');\n    });\n  }\n\n});\n\n// TODO: Re-add history support\n// window.addEventListener('popstate', function(e) {\n//   console.log('User pressed back, popping a state');\n//   console.log(e);\n//   if (e.state !== null && e.state.state !== undefined) {\n//     console.log('Moving back in history to state '+e.state.state);\n//     changeState(e.state.state, {}, false);\n//   } else {\n//     // Note safari calls popstate on page load so this is expected\n//     console.log('Uh oh, no valid state in history to move back to (this is expected on safari pageload)');\n//   }\n// });\n\n// TODO: set form fields to blur after enter pressed\n  // titleInputElem.addEventListener('keydown', function(key) {\n  //   if (key.keyCode == 13) {\n  //     this.blur();\n  //   }\n  // });\n\nvar redrawCurrentView = function () {\n  React.render(\n    <App />,\n    document.getElementById('appShell')\n  );\n};\n\nmodels.activities.addListener(redrawCurrentView);\nredrawCurrentView();\n"]}