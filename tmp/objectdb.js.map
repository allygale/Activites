{"version":3,"sources":["../client/js/objectdb.js"],"names":[],"mappings":"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","file":"objectdb.js","sourcesContent":["// Copyright 2014, Klaus Ganser <http://kganser.com>\n// MIT Licensed, with this copyright and permission notice\n// <http://opensource.org/licenses/MIT>\n\nvar objectDB = function() {\n\n  var makeKey = function(path) {\n    var key = path.length ? path[path.length-1] : '';\n    return [path.length < 2 && !key ? 0 : path.slice(0, -1).map(encodeURIComponent).join('/'), key];\n  };\n  var scopedRange = function(parent, lower, upper, le, ue) {\n    parent = parent.map(encodeURIComponent).join('/');\n    ue = upper == null || ue;\n    lower = lower == null ? [parent] : [parent, lower];\n    upper = upper == null ? [parent+'\\0'] : [parent, upper];\n    return IDBKeyRange.bound(lower, upper, le, ue);\n  };\n  var resolvePath = function(store, path, callback) {\n    // substitute array indices in path with numeric keys;\n    // second argument to callback is true if path is an empty array slot\n    path = path ? path.split('/').map(decodeURIComponent) : [];\n    (function advance(i, empty) {\n      while (i < path.length && !/0|[1-9][0-9]*/.test(path[i])) i++;\n      if (i == path.length) return callback(path, empty);\n      var position = parseInt(path[i]);\n      store.get(makeKey(path.slice(0, i))).onsuccess = function(e) {\n        var result = e.target.result;\n        if (!result) return callback(path, empty);\n        if (result.type != 'array') return advance(i+1);\n        // set to numeric index initially, and to key if element is found\n        path[i] = position;\n        store.openCursor(scopedRange(path.slice(0, i))).onsuccess = function(e) {\n          var cursor = e.target.result;\n          if (cursor && position) {\n            cursor.advance(position);\n            position = 0;\n          } else {\n            if (cursor) path[i] = cursor.value.key;\n            advance(i+1, !cursor);\n          }\n        };\n      };\n    }(0));\n  };\n  var get = function(store, path, callback, cursor) {\n    var next;\n    if (typeof cursor != 'function') cursor = function() {};\n    store.get(makeKey(path)).onsuccess = function(e) {\n      var result = e.target.result;\n      if (!result) return next || callback();\n      (next = function(result, parent, path, callback) {\n        var value = result.value,\n            type = result.type,\n            pending = 1,\n            index = 0;\n        if (type != 'object' && type != 'array')\n          return callback(value);\n        var array = type == 'array',\n            c = cursor(path, array);\n        value = array ? [] : {};\n        if (c === false) return callback(value);\n        if (!c || typeof c != 'object') c = {action: c || {}};\n        if (typeof c.action != 'function') c.action = function() {};\n        store.openCursor(\n          scopedRange(parent, c.lowerBound, c.upperBound, c.lowerExclusive, c.upperExclusive),\n          c.descending ? 'prev' : 'next'\n        ).onsuccess = function(e) {\n          var cursor = e.target.result;\n          if (!cursor) return --pending || callback(value);\n          var result = cursor.value,\n              key = array ? index++ : result.key,\n              action = c.action(key);\n          if (action == 'stop') return --pending || callback(value);\n          if (action != 'skip') {\n            value[key] = pending++;\n            next(result, parent.concat([result.key]), path.concat([key]), function(child) {\n              value[key] = child;\n              if (!--pending) callback(value);\n            });\n          }\n          cursor.continue();\n        };\n      })(result, path, [], callback);\n    };\n  };\n  var put = function(store, path, value, callback) {\n    // { key: (key or index relative to parent)\n    //   parent: (path of parent entry)\n    //   type: (string|number|boolean|null|array|object)\n    //   value: (or null if array or object) }\n    var type = Array.isArray(value) ? 'array' : typeof value == 'object' ? value ? 'object' : 'null' : typeof value,\n        key = makeKey(path),\n        pending = 1,\n        cb = function() { if (!--pending) callback(); };\n    store.put({parent: key[0], key: key[1], type: type, value: typeof value == 'object' ? null : value}).onsuccess = cb;\n    if (type == 'array') {\n      value.forEach(function(value, i) {\n        pending++;\n        put(store, path.concat([i]), value, cb);\n      });\n    } else if (type == 'object') {\n      Object.keys(value).forEach(function(key) {\n        pending++;\n        put(store, path.concat([key]), value[key], cb);\n      });\n    }\n  };\n  var append = function(store, path, value, callback) {\n    store.openCursor(scopedRange(path), 'prev').onsuccess = function(e) {\n      var cursor = e.target.result;\n      put(store, path.concat([cursor ? cursor.value.key+1 : 0]), value, callback);\n    };\n  };\n  var deleteChildren = function(store, path, callback) {\n    var pending = 1,\n        cb = function() { if (!--pending) callback(); };\n    store.openCursor(scopedRange(path)).onsuccess = function(e) {\n      var cursor = e.target.result;\n      if (!cursor) return cb();\n      var result = cursor.value;\n      pending++;\n      store.delete([result.parent, result.key]).onsuccess = cb;\n      if (result.type == 'object' || result.type == 'array') {\n        pending++;\n        deleteChildren(store, path.concat([result.key]), cb);\n      }\n      cursor.continue();\n    }\n  };\n\n  return {\n    open: function(database, upgrade, version, onError) {\n    /** objectDB: {\n          open: function(database:string, upgrade=`{}`:json|function(UpgradeTransaction), version=1:number, onError=undefined:function(error:DOMError, blocked:boolean)) -> Database,\n          delete: function(database:string, callback:function(error:undefined|DOMError, blocked:boolean)),\n          list: function(callback:function(DOMStringList))\n        }\n\n        ObjectDB is backed by `indexedDB`. An upgrade transaction runs on `open` if the database version is less than\n        the requested version or does not exist. If `upgrade` is a json value, the data stores in the first transaction\n        operation on this `Database` will be populated with this value on an upgrade event. Otherwise, an upgrade will\n        be handled by the given function via `UpgradeTransaction`. */\n      var self, db, queue, close, open = function(stores, callback) {\n        if (db) return callback();\n        if (queue) return queue.push(callback);\n        queue = [callback];\n        var request = indexedDB.open(database, version || 1);\n        request.onupgradeneeded = function(e) {\n          var self, db = e.target.result,\n              data = upgrade === undefined || typeof upgrade == 'function' ? {} : upgrade;\n          if (typeof upgrade != 'function') upgrade = function(db) {\n            (Array.isArray(stores) ? stores : [stores]).forEach(function(name) {\n              db.createObjectStore(name, data);\n            });\n          };\n          /** UpgradeTransaction: {\n                oldVersion: number,\n                newVersion: number,\n                createObjectStore: function(name:string, data=`{}`:json) -> UpgradeTransaction,\n                deleteObjectStore: function(name:string) -> UpgradeTransaction\n              } */\n          upgrade(self = {\n            oldVersion: e.oldVersion,\n            newVersion: e.newVersion,\n            createObjectStore: function(name, data) {\n              if (db.objectStoreNames.contains(name))\n                throw 'objectStore already exists';\n              put(db.createObjectStore(name, {keyPath: ['parent', 'key']}), [], data === undefined ? {} : data, function() {});\n              return self;\n            },\n            deleteObjectStore: function(name) {\n              if (db.objectStoreNames.contains(name))\n                db.deleteObjectStore(name);\n              return self;\n            }\n          });\n        };\n        request.onsuccess = function(e) {\n          db = e.target.result;\n          while (callback = queue.shift()) callback();\n          if (close) {\n            db.close();\n            close = null;\n          }\n        };\n        if (onError) {\n          request.onerror = function(e) { onError(e.target.error, false); };\n          request.onblocked = function() { onError(null, true); };\n        }\n      };\n      var transaction = function(type, stores, callback) {\n        var trans, pending = 0, values = [], self = {\n          get: get,\n          put: function(store, path, callback, value, insert, empty) {\n            var parentPath = path.slice(0, -1);\n            store.get(makeKey(parentPath)).onsuccess = function(e) {\n              var parent = e.target.result,\n                  key = path[path.length-1];\n              if (!parent && path.length)\n                return callback('Parent resource does not exist');\n              if (insert && (!path.length || parent.type != 'array'))\n                return callback('Parent resource is not an array');\n              if (parent && parent.type != 'object' && parent.type != 'array')\n                return callback('Parent resource is not an object or array');\n              if (parent && parent.type == 'array' && typeof key != 'number')\n                return callback('Invalid index to array resource');\n              if (empty) { // array slot\n                append(store, parentPath, value, callback);\n              } else if (insert) {\n                var i = 0, lastShiftKey = key;\n                store.openCursor(scopedRange(parentPath, key)).onsuccess = function(e) {\n                  var cursor = e.target.result;\n                  if (cursor && cursor.value.key == key+i++) {\n                    // all contiguous keys after desired position must be shifted by one\n                    lastShiftKey = cursor.value.key;\n                    return cursor.continue();\n                  }\n                  // found last key to shift; now shift subsequent elements' keys\n                  var pending = 1,\n                      cb = function() { if (!--pending) callback(); };\n                  store.openCursor(scopedRange(parentPath, key, lastShiftKey), 'prev').onsuccess = function(e) {\n                    cursor = e.target.result;\n                    if (!cursor) return put(store, path, value, cb);\n                    var index = cursor.value.key,\n                        currentPath = parentPath.concat([index]);\n                    pending++;\n                    get(store, currentPath, function(result) { // TODO: delete/put within cursor\n                      deleteChildren(store, currentPath, function() {\n                        put(store, parentPath.concat([index+1]), result, cb);\n                        cursor.continue();\n                      });\n                    });\n                  };\n                };\n              } else {\n                deleteChildren(store, path, function() {\n                  put(store, path, value, callback);\n                });\n              }\n            };\n          },\n          append: function(store, path, callback, value) {\n            store.get(makeKey(path)).onsuccess = function(e) {\n              var parent = e.target.result;\n              if (!parent)\n                return callback('Parent resource does not exist');\n              if (parent.type != 'array')\n                return callback('Parent resource is not an array');\n              append(store, path, value, callback);\n            };\n          },\n          delete: function(store, path, callback) {\n            store.delete(makeKey(path));\n            deleteChildren(store, path, callback);\n          }\n        };\n        Object.keys(self).forEach(function(name) {\n          var method = self[name];\n          var wrapped = function(store, path, value, insert) {\n            var i = values.push(pending++)-1, p = path;\n            resolvePath(store = trans.objectStore(store), path, function(path, empty) {\n              method(store, path, function(value) {\n                values[i] = value;\n                if (!--pending) {\n                  var v = values;\n                  values = [];\n                  callback.apply(null, v);\n                }\n              }, value, insert, empty);\n            });\n          };\n          self[name] = function(store, path, value, insert) {\n            if (trans) return wrapped(store, path, value, insert);\n            open(stores, function() {\n              if (!trans) trans = db.transaction(stores, type);\n              wrapped(store, path, value, insert);\n            });\n          };\n        });\n        return self;\n      };\n      /** Database: {\n            transaction: function(writable=false:boolean, stores='data':[string, ...]|string) -> Transaction|ScopedTransaction,\n            get: function(path='':string, writable=false:boolean, cursor=undefined:Cursor, store='data':string) -> ScopedTransaction,\n            put: function(path='':string, value:json, store='data':string) -> ScopedTransaction,\n            insert: function(path='':string, value:json, store='data':string) -> ScopedTransaction,\n            append: function(path='':string, value:json, store='data':string) -> ScopedTransaction,\n            delete: function(path='':string, store='data':string) -> ScopedTransaction,\n            close: function\n          }\n\n          `get`, `put`, `insert`, `append`, and `delete` are convenience methods that operate through `transaction` for\n          a single objectStore and return the corresponding `ScopedTransaction`. `get` initiates a read-only\n          transaction by default. `transaction` returns a `ScopedTransaction` if a single (string) objectStore is\n          specified, and a `Transaction` if operating on multiple objectStores. */\n      return self = {\n        transaction: function(writable, stores) {\n          if (stores == null) stores = 'data';\n          var self, cb, trans = transaction(writable ? 'readwrite' : 'readonly', stores, function() {\n            if (cb) cb.apply(self, arguments);\n          });\n          /** Transaction: {\n                get: function(store:string, path='':string, cursor=undefined:Cursor) -> Transaction,\n                put: null|function(store:string, path='':string, value:json) -> Transaction,\n                insert: null|function(store:string, path='':string, value:json) -> Transaction,\n                append: null|function(store:string, path='':string, value:json) -> Transaction,\n                delete: null|function(store:string, path='':string) -> Transaction,\n                then: function(callback:function(this:Transaction, json|undefined, ...))\n              }\n\n              A `Transaction` acting on multiple data stores must specify a data store as the first argument to every\n              operation. Otherwise, these methods correspond to `ScopedTransaction` methods. */\n\n          /** ScopedTransaction: {\n                get: function(path='':string, cursor=undefined:Cursor) -> ScopedTransaction,\n                put: null|function(path='':string, value:json) -> ScopedTransaction,\n                insert: null|function(path='':string, value:json) -> ScopedTransaction,\n                append: null|function(path='':string, value:json) -> ScopedTransaction,\n                delete: null|function(path='':string) -> ScopedTransaction,\n                then: function(callback:function(this:ScopedTransaction, json|undefined, ...))\n              }\n\n              All methods except `then` are chainable and execute on the same transaction in parallel. If the\n              transaction is not writable, `put`, `insert`, `append`, and `delete` are null.\n\n              `path` is a `/`-separated string of array indices and `encodeURIComponent`-encoded object keys denoting\n              the path to the desired element within the object store's json data structure; e.g.\n              `'users/123/firstName'`. If undefined, `cursor` buffers all data at the requested path as the result of a\n              `get` operation. `insert` will splice the given `value` into the parent array at the specified position,\n              shifting any subsequent elements forward.\n\n              When all pending operations complete, `callback` is called with the result of each queued operation in\n              order. More operations can be queued onto the same transaction at that time via `this`.\n\n              Results from `put`, `insert`, `append`, and `delete` are error strings or undefined if successful. `get`\n              results are json data or undefined if no value exists at the requested path. */\n\n          /** Cursor: function(path:[string|number, ...], array:boolean) -> boolean|Action|{\n                lowerBound=null: string|number,\n                lowerExclusive=false: boolean,\n                upperBound=null: string|number,\n                upperExclusive=false: boolean,\n                descending=false: boolean,\n                action: Action\n              } */\n\n          /** Action:function(key:string|number) -> undefined|string\n\n              `Cursor` is a function called for each array or object encountered in the requested json structure. It is\n              called with a `path` array (of strings and/or numeric indices) relative to the requested path (i.e. `[]`\n              represents the path as requested in `get`) and an `array` boolean that is true if the substructure is an\n              array. It returns an `Action` callback or object with a range and `action`, or false to prevent\n              recursion into the structure. `lowerBound` and `upperBound` restrict the keys/indices traversed for this\n              object/array, and the `Action` function is called with each `key` in the requested range, in order. The\n              `Action` callback can optionally return either `'skip'` or `'stop'` to exclude the element at the given\n              key from the structure or to exclude and stop iterating, respectively.\n\n              For example, the following call uses a cursor to fetch only the immediate members of the object at the\n              requested path. Object and array values will be empty:\n\n             `db.get('path/to/object', function(path) {\n                return !path.length;\n              });`\n\n              The following call will get immediate members of the requested object sorted lexicographically (by code\n              unit value) up to and including key value `'c'`, but excluding key `'abc'` (if any):\n\n             `db.get('path/to/object', function(path) {\n                return path.length ? false : {\n                  upperBound: 'c',\n                  action: function(key) {\n                    if (key == 'abc') return 'skip';\n                  }\n                };\n              });` */\n          return self = Array.isArray(stores) ? {\n            get: function(store, path, cursor) {\n              trans.get(store, path, cursor);\n              return self;\n            },\n            put: !writable ? null : function(store, path, value) {\n              trans.put(store, path, value);\n              return self;\n            },\n            insert: !writable ? null : function(store, path, value) {\n              trans.put(store, path, value, true);\n              return self;\n            },\n            append: !writable ? null : function(store, path, value) {\n              trans.append(store, path, value);\n              return self;\n            },\n            // Removed to avoid error with grunt\n            // delete: !writable ? null : function(store, store, path) {\n            //   trans.delete(store, store, path);\n            //   return self;\n            // },\n            then: function(callback) {\n              cb = callback;\n            }\n          } : {\n            get: function(path, cursor) {\n              trans.get(stores, path, cursor);\n              return self;\n            },\n            put: !writable ? null : function(path, value) {\n              trans.put(stores, path, value);\n              return self;\n            },\n            insert: !writable ? null : function(path, value) {\n              trans.put(stores, path, value, true);\n              return self;\n            },\n            append: !writable ? null : function(path, value) {\n              trans.append(stores, path, value);\n              return self;\n            },\n            delete: !writable ? null : function(path) {\n              trans.delete(stores, path);\n              return self;\n            },\n            then: function(callback) {\n              cb = callback;\n            }\n          };\n        },\n        get: function(path, writable, cursor, store) {\n          return self.transaction(writable, store).get(path, cursor);\n        },\n        put: function(path, value, store) {\n          return self.transaction(true, store).put(path, value);\n        },\n        insert: function(path, value, store) {\n          return self.transaction(true, store).insert(path, value);\n        },\n        append: function(path, value, store) {\n          return self.transaction(true, store).append(path, value);\n        },\n        delete: function(path, store) {\n          return self.transaction(true, store).delete(path);\n        },\n        close: function() {\n          if (db) {\n            db.close();\n            db = null;\n          } else {\n            close = true;\n          }\n        }\n      };\n    },\n    delete: function(database, callback) {\n      var request = indexedDB.deleteDatabase(database);\n      request.onsuccess = request.onerror = function(e) {\n        callback(e.target.error, false);\n      };\n      request.onblocked = function() {\n        callback(null, true);\n      };\n    },\n    list: function(callback) {\n      indexedDB.webkitGetDatabaseNames().onsuccess = function(e) {\n        callback(e.target.result);\n      };\n    }\n  };\n}();\n\nmodule.exports = objectDB;\n"]}