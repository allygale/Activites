{"version":3,"sources":["../client/js/edit-activity.js"],"names":[],"mappings":";;;AACA,IAAI,KAAK,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC;AAC7B,IAAI,CAAC,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC1B,IAAI,IAAI,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;AAChC,IAAI,WAAW,GAAG,OAAO,CAAC,mBAAmB,CAAC,CAAC;AAC/C,IAAI,kBAAkB,GAAG,OAAO,CAAC,yBAAyB,CAAC,CAAC;;;AAG5D,IAAI,MAAM,GAAG,OAAO,CAAC,aAAa,CAAC,CAAC;AACpC,IAAI,SAAS,GAAG,OAAO,CAAC,cAAc,CAAC,CAAA;;AAEvC,MAAM,CAAC,OAAO,GAAG,KAAK,CAAC,WAAW,CAAC;;;AACjC,iBAAe,EAAE,2BAAY;AAC3B,WAAO;AACL,WAAK,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,KAAK,GAAG,EAAE;AAC3D,iBAAW,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,WAAW,GAAG,EAAE;AACvE,gBAAU,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,UAAU,GAAG,IAAI,CAAC,KAAK,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,GAAG,CAAC,EAAC,IAAI,EAAE,EAAE,EAAC,CAAC;AAC7G,YAAM,EAAE,KAAK;KACd,CAAC;GACH;AACD,mBAAiB,EAAE,6BAAY;;AAE7B,QAAI,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE;AACxB,UAAI,CAAC,IAAI,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC,KAAK,EAAE,CAAC;KAC3C;;;;GAIF;AACD,mBAAiB,EAAE,2BAAU,CAAC,EAAE;AAC9B,QAAI,CAAC,QAAQ,CAAC,EAAC,KAAK,EAAE,CAAC,CAAC,MAAM,CAAC,KAAK,EAAC,CAAC,CAAC;GACxC;AACD,yBAAuB,EAAE,iCAAU,CAAC,EAAE;AACpC,QAAI,CAAC,QAAQ,CAAC,EAAC,WAAW,EAAE,CAAC,CAAC,MAAM,CAAC,KAAK,EAAC,CAAC,CAAC;GAC9C;AACD,kBAAgB,EAAE,0BAAU,CAAC,EAAE;;AAE7B,QAAI,OAAO,GAAG,IAAI,IAAI,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;;AAEvC,WAAO,CAAC,UAAU,CAAC,OAAO,CAAC,iBAAiB,EAAE,CAAC,CAAA;AAC/C,QAAI,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;;AAEjD,gBAAY,CAAC,GAAG,CAAC;AACf,SAAG,EAAE,OAAO,CAAC,OAAO,EAAE;AACtB,WAAK,EAAE,OAAO,CAAC,QAAQ,EAAE;;AAEzB,UAAI,EAAE,IAAI,GAAG,OAAO,CAAC,OAAO,EAAE;KAC/B,CAAC,CAAC;AACH,WAAO,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC;AAC1B,QAAI,CAAC,QAAQ,CAAC,EAAC,UAAU,EAAE,YAAY,EAAC,CAAC,CAAC;GAC3C;AACD,kBAAgB,EAAE,0BAAU,CAAC,EAAE;AAC7B,QAAI,GAAG,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;AACpC,QAAI,IAAI,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AAC5B,QAAI,MAAM,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;AAC9B,QAAI,YAAY,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;AACjD,QAAI,YAAY,GAAG,YAAY,CAAC,GAAG,CAAC;AAClC,UAAI,EAAE,IAAI;AACV,YAAM,EAAE,MAAM;KACf,CAAC,CAAC;AACH,QAAI,CAAC,QAAQ,CAAC,EAAC,UAAU,EAAE,YAAY,EAAC,CAAC,CAAC;GAC3C;AACD,mBAAiB,EAAE,2BAAU,CAAC,EAAE;AAC9B,QAAI,UAAU,GAAG,CAAC,CAAC,MAAM,CAAC;AAC1B,QAAI,CAAC,QAAQ,CAAC,EAAC,MAAM,EAAE,IAAI,EAAC,CAAC,CAAC;;AAE9B,QAAI,eAAe,GAAG,EAAC,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,WAAW,EAAE,IAAI,CAAC,KAAK,CAAC,WAAW,EAAE,UAAU,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU,EAAC,CAAC;;AAExH,UAAM,CAAC,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,eAAe,EAAE,CAAA,YAAY;AACpF,UAAI,CAAC,KAAK,CAAC,cAAc,EAAE,CAAC;KAC7B,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,YAAY;AACxB,WAAK,CAAC,2CAA2C,CAAC,CAAC;AACnD,YAAM,4DAA4D,CAAE;KACrE,CAAC,CAAC;GACJ;AACD,qBAAmB,EAAE,+BAAY;AAC/B,QAAI,WAAW,GAAG;AAChB,WAAK,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK;AACvB,gBAAU,EAAE,IAAI,CAAC,KAAK,CAAC,UAAU;AACjC,cAAQ,EAAE,EAAE;AACZ,mBAAa,EAAE,CAAC,CAAC;AACjB,iBAAW,EAAE,IAAI,CAAC,KAAK,CAAC,WAAW;KACpC,CAAC;AACF,UAAM,CAAC,UAAU,CAAC,iBAAiB,CAAC,WAAW,EAAE,CAAA,YAAY;AAC3D,UAAI,CAAC,KAAK,CAAC,gBAAgB,EAAE,CAAC;KAC/B,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,YAAY;;AAExB,WAAK,CAAC,kFAAkF,CAAC,CAAC;AAC1F,YAAM,uDAAuD,CAAE;KAChE,CAAC,CAAC;GACJ;AACD,qBAAmB,EAAE,+BAAY;AAC/B,QAAI,OAAO,CAAC,kGAAkG,CAAC,EAAE;AAC9G,YAAM,CAAC,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAA,YAAY;AACnE,YAAI,CAAC,gBAAgB,EAAE,CAAC;OACzB,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,YAAY;AACxB,aAAK,CAAC,8CAA8C,CAAC,CAAC;AACtD,cAAM,2DAA2D,CAAE;OACpE,CAAC,CAAC;KACJ,MAAM;;KAEN;GACH;AACD,QAAM,EAAE,kBAAY;AAClB,QAAI,OAAO,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC;;;;AAIpC,QAAI,UAAU,GAAG;AACf,aAAO,EAAE,OAAO;AAChB,eAAS,EAAE,YAAY;AACvB,WAAK,EAAE,MAAM;AACb,YAAM,EAAE,QAAQ;AAChB,aAAO,EAAE,oBAAoB;AAC7B,eAAS,EAAE,MAAM;AACjB,iBAAW,EAAE,MAAM;AACnB,kBAAY,EAAE,8BAA8B;AAC5C,gBAAU,EAAE,MAAM;AAClB,qBAAe,EAAE,eAAe;AAChC,aAAO,EAAE,MAAM;;AAEf,kBAAY,EAAE,CAAC;KAChB,CAAC;;AAEF,QAAI,OAAO,GAAG,EAAE,CAAC;AACjB,QAAI,aAAa,CAAC;AAClB,QAAI,OAAO,EAAE;AACX,mBAAa,GAAG,EAAC,KAAK,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,CAAC,iBAAiB,EAAC,CAAC;AACjE,UAAI,IAAI,CAAC,KAAK,CAAC,MAAM,EAAE;AACrB,qBAAa,CAAC,KAAK,GAAG,WAAW,CAAC;AAClC,qBAAa,CAAC,QAAQ,GAAG,IAAI,CAAC;OAC/B;AACD,UAAI,YAAY,GAAG,EAAC,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,IAAI,CAAC,mBAAmB,EAAE,QAAQ,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAC,CAAC;AACvG,aAAO,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;KAC5B,MAAM;AACL,mBAAa,GAAG,EAAC,KAAK,EAAE,QAAQ,EAAE,OAAO,EAAE,IAAI,CAAC,mBAAmB,EAAC,CAAC;KACtE;AACD,WAAO,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;;;AAG5B,QAAI,sBAAsB,GAAG,SAAzB,sBAAsB,CAAY,IAAI,EAAE;AAC1C,aAAO,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;KAC/B,CAAA;AACD,QAAI,sBAAsB,GAAG,SAAzB,sBAAsB,CAAY,IAAI,EAAE;AAC1C,aAAO,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;KACpC,CAAA;AACD,QAAI,uBAAuB,GAAG,SAA1B,uBAAuB,GAAe;AACxC,aAAO,IAAI,CAAC,KAAK,EAAE,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;KAC5C,CAAA;AACD,QAAI,0BAA0B,GAAG,SAA7B,0BAA0B,GAAe;AAC3C,aAAO,IAAI,CAAC,KAAK,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC;KAC1D,CAAA;AACD,WACE;AAAC,UAAI;;MACH;;UAAK,KAAK,EAAE,EAAC,OAAO,EAAE,MAAM,EAAC,AAAC;QAC5B;;;UAAI,IAAI,CAAC,KAAK,CAAC,QAAQ;SAAK;;QAAG,+BAAM;QACrC;AACE,aAAG,EAAC,YAAY;AAChB,cAAI,EAAC,MAAM;AACX,eAAK,EAAE,CAAC,CAAC,UAAU,EAAE,EAAC,QAAQ,EAAE,OAAO,EAAC,CAAC,AAAC;AAC1C,mBAAS,EAAC,0CAA0C;AACpD,eAAK,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,AAAC;AACxB,qBAAW,EAAC,iBAAiB;AAC7B,wBAAc,EAAC,OAAO;AACtB,kBAAQ,MAAA;AACR,kBAAQ,EAAE,IAAI,CAAC,iBAAiB,AAAC,GAC3B;QACR;AACE,cAAI,EAAC,MAAM;AACX,eAAK,EAAE,CAAC,CAAC,UAAU,EAAE,EAAC,KAAK,EAAE,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,EAAC,CAAC,AAAC;AACtE,mBAAS,EAAC,0CAA0C;AACpD,aAAG,EAAE,uBAAuB,EAAE,AAAC;AAC/B,eAAK,EAAG,sBAAsB,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,AAAE;AACvD,kBAAQ,EAAE,IAAI,CAAC,gBAAgB,AAAC;AAChC,kBAAQ,MAAA,GACF;QACR;AACE,cAAI,EAAC,MAAM;AACX,eAAK,EAAE,CAAC,CAAC,UAAU,EAAE,EAAC,KAAK,EAAE,OAAO,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAC,CAAC,AAAC;AACxE,mBAAS,EAAC,0CAA0C;AACpD,cAAI,EAAC,KAAK;AACV,eAAK,EAAG,sBAAsB,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC,AAAE;AACvD,kBAAQ,EAAE,IAAI,CAAC,gBAAgB,AAAC;AAChC,kBAAQ,MAAA,GACF;QACR,6BAAK,KAAK,EAAE,EAAC,KAAK,EAAE,MAAM,EAAC,AAAC,GAAO;QACnC,oBAAC,kBAAkB;AACjB,YAAE,EAAC,aAAa;AAChB,eAAK,EAAE,UAAU,AAAC;AAClB,mBAAS,EAAC,gBAAgB;AAC1B,qBAAW,EAAC,wCAAwC;AACpD,cAAI,EAAC,GAAG;AACR,iBAAO,EAAC,GAAG;AACX,eAAK,EAAE,IAAI,CAAC,KAAK,CAAC,WAAW,AAAC;AAC9B,kBAAQ,EAAE,IAAI,CAAC,uBAAuB,AAAC,GACpB;OACjB;MACN,oBAAC,WAAW,IAAC,OAAO,EAAE,OAAO,AAAC,GAAE;KAC3B,CACR;GACF;CACF,CAAC,CAAC","file":"edit-activity.js","sourcesContent":["// Require react, convenience libraries and UI components\nvar React = require('react');\nvar m = require('./m.js');\nvar Card = require('./card.js');\nvar CardOptions = require('./card-options.js');\nvar TextAreaAutoResize = require('react-textarea-autosize');\n\n// Require core logic\nvar models = require('./models.js');\nvar swLibrary = require('./swsetup.js')\n\nmodule.exports = React.createClass({\n  getInitialState: function () {\n    return {\n      title: this.props.activity ? this.props.activity.title : '',\n      description: this.props.activity ? this.props.activity.description : '',\n      start_time: this.props.activity ? this.props.activity.start_time : Date.today().add(1).days().set({hour: 16}),\n      saving: false\n    };\n  },\n  componentDidMount: function () {\n    // Focus the title input if we're creating\n    if (!this.props.activity) {\n      this.refs.titleInput.getDOMNode().focus();\n    }\n    // Disabled as it scrolled poorly on iOS\n    // this.refs.titleInput.getDOMNode().scrollIntoView();\n    // TODO: If we scrolled into view the elem may be hidden behind the header\n  },\n  handleTitleChange: function (e) {\n    this.setState({title: e.target.value});\n  },\n  handleDescriptionChange: function (e) {\n    this.setState({description: e.target.value});\n  },\n  handleDateChange: function (e) {\n    // Note date will parse the date as if it was UTC, and then convert it into local TZ\n    var newDate = new Date(e.target.value);\n    // To solve the parsing as UTC issue we add the timezone offset\n    newDate.addMinutes(newDate.getTimezoneOffset())\n    var newStartTime = this.state.start_time.clone();\n    // Set the date component of the state without modifying time\n    newStartTime.set({\n      day: newDate.getDate(),\n      month: newDate.getMonth(),\n      // Year values start at 1900\n      year: 1900 + newDate.getYear()\n    });\n    console.log(newStartTime);\n    this.setState({start_time: newStartTime});\n  },\n  handleTimeChange: function (e) {\n    var tmp = e.target.value.split(':');\n    var hour = parseInt(tmp[0]);\n    var minute = parseInt(tmp[1]);\n    var oldStartTime = this.state.start_time.clone();\n    var newStartTime = oldStartTime.set({\n      hour: hour,\n      minute: minute\n    });\n    this.setState({start_time: newStartTime});\n  },\n  handleSaveClicked: function (e) {\n    var thisButton = e.target;\n    this.setState({saving: true});\n\n    var activityChanges = {title: this.state.title, description: this.state.description, start_time: this.state.start_time};\n\n    models.activities.tryUpdateActivity(this.props.activity, activityChanges, function () {\n      this.props.onSaveComplete();\n    }.bind(this), function () {\n      alert('An error occurred! Sorry. Please refresh.');\n      throw('Editing the activity failed. Help the user understand why.');\n    });\n  },\n  handleCreateClicked: function () {\n    var newActivity = {\n      title: this.state.title,\n      start_time: this.state.start_time,\n      location: '',\n      max_attendees: -1,\n      description: this.state.description\n    };\n    models.activities.tryCreateActivity(newActivity, function () {\n      this.props.onCreateComplete();\n    }.bind(this), function () {\n      // thisButton.classList.toggle('disabled', false);\n      alert('Sorry, something went wrong. Please check you entered the information correctly.');\n      throw(\"Adding to server failed. Help the user understand why\");\n    });\n  },\n  handleDeleteClicked: function () {\n    if (confirm('This will notify friends coming that the event is cancelled and remove it from the app. Confirm?')) {\n       models.activities.tryCancelActivity(this.props.activity, function () {\n         this.onDeleteComplete();\n       }.bind(this), function () {\n         alert('An error occurred! Sorry :(. Please refresh.');\n         throw(\"Cancelling on server failed. Help the user understand why\");\n       });\n     } else {\n       // Do nothing\n     }\n  },\n  render: function () {\n    var editing = !!this.props.activity;\n    /*\n      Set up styles\n    */\n    var inputStyle = {\n      display: 'block',\n      boxSizing: 'border-box',\n      width: '100%',\n      margin: '10px 0',\n      padding: '10px 10px 10px 2px',\n      borderTop: 'none',\n      borderRight: 'none',\n      borderBottom: '1px solid rgba(0, 0, 0, 0.1)',\n      borderLeft: 'none',\n      backgroundColor: 'rgba(0,0,0,0)',\n      outline: 'none',\n      // This prevents iOS from rounding corners on input elements\n      borderRadius: 0\n    };\n    // Set up the options on the card\n    var options = [];\n    var defaultOption;\n    if (editing) {\n      defaultOption = {label: 'Save', onClick: this.handleSaveClicked};\n      if (this.state.saving) {\n        defaultOption.label = 'Saving...';\n        defaultOption.disabled = true;\n      }\n      var deleteOption = {label: 'Delete', onClick: this.handleDeleteClicked, position: 'left', type: 'bad'};\n      options.push(deleteOption);\n    } else {\n      defaultOption = {label: 'Create', onClick: this.handleCreateClicked};\n    }\n    options.push(defaultOption);\n    // Provide dates and times for the input elements\n    // Documentation for date formatting: https://code.google.com/p/datejs/wiki/FormatSpecifiers\n    var getHyphenSeparatedTime = function(date) {\n      return date.toString('HH:mm');\n    }\n    var getHyphenSeparatedDate = function(date) {\n      return date.toString('yyyy-MM-dd');\n    }\n    var getHyphenSeparatedToday = function () {\n      return Date.today().toString('yyyy-MM-dd');\n    }\n    var getHyphenSeparatedTomorrow = function () {\n      return Date.today().add(1).days().toString('yyyy-MM-dd');\n    }\n    return (\n      <Card>\n        <div style={{padding: '24px'}}>\n          <b>{this.props.userName}</b> is<br />\n          <input\n            ref='titleInput'\n            type='text'\n            style={m(inputStyle, {fontSize: '1.2em'})}\n            className='input-placeholder-lighter focusUnderline'\n            value={this.state.title}\n            placeholder='Watching Frozen'\n            autoCapitalize='words'\n            required\n            onChange={this.handleTitleChange}>\n          </input>\n          <input\n            type='date'\n            style={m(inputStyle, {float: 'left', fontSize: '1em', width: 'auto'})}\n            className='input-placeholder-lighter focusUnderline'\n            min={getHyphenSeparatedToday()}\n            value={ getHyphenSeparatedDate(this.state.start_time) }\n            onChange={this.handleDateChange}\n            required>\n          </input>\n          <input\n            type='time'\n            style={m(inputStyle, {float: 'right', fontSize: '1em', width: '150px'})}\n            className='input-placeholder-lighter focusUnderline'\n            step=\"900\"\n            value={ getHyphenSeparatedTime(this.state.start_time) }\n            onChange={this.handleTimeChange}\n            required>\n          </input>\n          <div style={{clear: 'both'}}></div>\n          <TextAreaAutoResize\n            id='description'\n            style={inputStyle}\n            className='focusUnderline'\n            placeholder='Extra information (where? when? what?)'\n            rows='1'\n            maxRows='8'\n            value={this.state.description}\n            onChange={this.handleDescriptionChange}>\n          </TextAreaAutoResize>\n        </div>\n        <CardOptions options={options}/>\n      </Card>\n    )\n  }\n});\n"]}